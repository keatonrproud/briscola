<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Briscola</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <script src="/static/script.js" defer></script>
</head>
<body>
    <div class="container">
        <div class="intro-card">
            <h1 class="title">Welcome to Briscola!</h1>
            <br>

            <div class="game-mode-selector">
                <span class="mode-label left-label" aria-label="Computer">ðŸ’»</span>
                <label class="toggle">
                    <input type="checkbox" id="game-mode-toggle">
                    <span class="slider"></span>
                </label>
                <span class="mode-label right-label" aria-label="Local">ðŸ‘¥</span>
            </div>
            <button class="button" id="start-game-btn">Start Game</button>
        </div>
    </div>

    <script>
            document.addEventListener('DOMContentLoaded', () => {
            const startGameButton = document.getElementById('start-game-btn');
            const gameModeToggle = document.getElementById('game-mode-toggle');
            const leftLabel = document.querySelector('.left-label');
            const rightLabel = document.querySelector('.right-label');

            if (startGameButton && gameModeToggle) {
            startGameButton.addEventListener('click', async () => {
            const gameMode = gameModeToggle.checked ? 'local' : 'computer';

            try {
            const response = await fetch('/api/reset_state', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
        },
            body: JSON.stringify({gameMode: gameMode})
        });

            if (!response.ok) {
            throw new Error('Network response was not ok');
        }

            const data = await response.json();
            window.location.href = '/turn';
        } catch (error) {
            console.error('Error:', error);
            // Optionally: provide user feedback or retry logic here
        }
        });
        }

            function updateLabels() {
            if (gameModeToggle.checked) {
            leftLabel.style.opacity = '0.5';
            rightLabel.style.opacity = '1';
        } else {
            leftLabel.style.opacity = '1';
            rightLabel.style.opacity = '0.5';
        }
        }

            // Add event listeners to emoji icons to toggle the checkbox
            leftLabel.addEventListener('click', () => {
            gameModeToggle.checked = false;
            updateLabels();
        });

            rightLabel.addEventListener('click', () => {
            gameModeToggle.checked = true;
            updateLabels();
        });

            gameModeToggle.addEventListener('change', updateLabels);
            updateLabels(); // Initial call to set the correct state on page load
        });
    </script>
</body>
</html>
